<!doctype html><html lang=fr><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Blog qui parle de lecture et de web"><meta name=keywords content="hugo,html,lecture,web,shortcode"><title>Schrek.fr</title>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="My PWA"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js")</script><meta property="og:url" content="https://schrek.fr/posts/2023/09/hugo-pwa/"><meta property="og:site_name" content="Schrek.fr"><meta property="og:title" content="Hugo et Pwa"><meta property="og:description" content="Le PWA (Progressive Web App) permet de faire ressembler un site a une application."><meta property="og:locale" content="fr_fr"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-20T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-20T00:00:00+00:00"><meta property="article:tag" content="Liens"><meta property="article:tag" content="Hugo"><meta property="article:tag" content="Pwa"><meta property="og:see_also" content="https://schrek.fr/posts/2024/12/hugo-recherche/"><meta property="og:see_also" content="https://schrek.fr/posts/2024/3/commentaires/"><meta property="og:see_also" content="https://schrek.fr/posts/2024/2/katex/"><meta property="og:see_also" content="https://schrek.fr/posts/2023/08/hugo-shortcode-bouton/"><meta property="og:see_also" content="https://schrek.fr/posts/2023/08/hugo-et-nuages-de-tags/"><meta property="og:see_also" content="https://schrek.fr/posts/2023/08/hugo-et-les-liens/"><link href=/css/uikit.min.min.74065b0cc0cc771b6d0c8cdd1571f95022330dbe057cfe7f5c22ddf003313c6715e6047ab88bb5766ca27342b6d7b572f78f0fa2110438c5a0edeb269788d553.css rel=stylesheet integrity="sha512-dAZbDMDMdxttDIzdFXH5UCIzDb4FfP5/XCLd8AMxPGcV5gR6uIu1dmyic0K217Vy948PohEEOMWg7esml4jVUw==" crossorigin=anonymous><link href=/css/styles.min.afcd884f8dd136efa1b96e7cda014003cf94c49f183f0ef14bd022c6177e966c32c7161005a9388651cb103eec51f4106a0aa012b8812a467a1429f3d13cddd1.css rel=stylesheet integrity="sha512-r82IT43RNu+huW582gFAA8+UxJ8YPw7xS9Aixhd+lmwyxxYQBak4hlHLED7sUfQQagqgEriBKkZ6FCnz0Tzd0Q==" crossorigin=anonymous></head><body><header><nav class="uk-navbar-container uk-navbar-transparent" uk-navbar><div class=uk-navbar-center><a class="uk-navbar-item uk-logo" href=https://schrek.fr/><h1 classe=uk-heading-small>Schrek.fr</h1></a><ul class=uk-navbar-nav><li><a href=/><span uk-icon="icon:home; ratio: 2"></span></a><div class=uk-navbar-subtitle>Home</div></li><li><a href=/pages/apropos/><span uk-icon="icon:info; ratio: 2"></span></a><div class=uk-navbar-subtitle>A Propos</div></li><li><a href=/wiki/><span uk-icon="icon:database; ratio: 2"></span></a><div class=uk-navbar-subtitle>Wiki</div></li><li><a href=/notes/><span uk-icon="icon:pencil; ratio: 2"></span></a><div class=uk-navbar-subtitle>Notes</div></li><li><a href=/pages/tagscloud/><span uk-icon="icon:hashtag; ratio: 2"></span></a><div class=uk-navbar-subtitle>Tags</div></li><li><a href=/pages/search/><span uk-icon="icon:search; ratio: 2"></span></a><div class=uk-navbar-subtitle>Recherche</div></li><li><a href=/index.xml><span uk-icon="icon:rss; ratio: 2"></span></a><div class=uk-navbar-subtitle>RSS</div></li></ul></div></nav><hr class=uk-divider-icon></header><main><div class="uk-container uk-background-muted uk-box-shadow-large uk-padding"><ol class=uk-breadcrumb><li><a href=/>home</a></li><li><a href=https://schrek.fr/posts>posts</a></li><li><a href=https://schrek.fr/posts/2023>2023</a></li><li><a href=https://schrek.fr/posts/2023/09>09</a></li><li><a href=https://schrek.fr/posts/2023/09/hugo-pwa>hugo-pwa</a></li></ol><article class=uk-article><h1 class=uk-article-title>Hugo et Pwa</h1><p class=uk-article-meta>2023-09-20
<span class="labelcat uk-label"><a href=/categories/web>Web</a></span><br><i>Temps de lecture: 5 minutes.</i></p><p>Cet article fait partie de la série: <a href=https://schrek.fr//series/hugo>Hugo</a></p><br><p class=uk-text-lead><div class="uk-section uk-align-right"><div class="uk-card-small uk-card-default uk-card-body" uk-scrollspy="cls: uk-animation-slide-right; repeat: false"><h3 class=uk-card-title>Table des matières</h3><p class="toc uk-text-small"><nav id=TableOfContents><ul><li><a href=#mode-hors-ligne>Mode hors ligne</a></li><li><a href=#les-icônes>Les icônes</a></li><li><a href=#manifestjson>Manifest.json</a></li><li><a href=#le-service-worker>Le service worker</a></li><li><a href=#partial>Partial</a></li><li><a href=#mots-de-la-fin>Mots de la fin</a></li><li><a href=#liens>Liens</a></li></ul></nav></p></div></div><p>Le PWA (Progressive Web App) permet de faire ressembler un site a une application.</p><h2 id=mode-hors-ligne>Mode hors ligne</h2><p>Le squelette de la page <em>Hors ligne</em></p><p><em>/themes/VOTRETHEME/layouts/_default/hors_ligne.html</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go-html-template data-lang=go-html-template><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span> &lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>title</span>&gt;<span style=color:#75715e>{{</span> <span style=color:#a6e22e>.Title</span> <span style=color:#75715e>}}</span>&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span> &lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span> &lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>h1</span>&gt;<span style=color:#75715e>{{</span> <span style=color:#a6e22e>.Title</span> <span style=color:#75715e>}}</span>&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#75715e>{{</span> <span style=color:#a6e22e>.Content</span> <span style=color:#75715e>}}</span>
</span></span><span style=display:flex><span> &lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;</span></span></code></pre></div><p>La page <em>Hors ligne</em></p><p><em>/pages/hors_ligne/index.md</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go-html-template data-lang=go-html-template><span style=display:flex><span>---
</span></span><span style=display:flex><span>title: &#34;Hors ligne&#34;
</span></span><span style=display:flex><span>date: 2023-04-07
</span></span><span style=display:flex><span>layout: hors_ligne
</span></span><span style=display:flex><span>toc: false
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>**Hors ligne**
</span></span><span style=display:flex><span><span style=color:#75715e>{{</span><span style=color:#960050;background-color:#1e0010>&lt;</span>  <span style=color:#a6e22e>figure</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;wifi.png&#34;</span> <span style=color:#a6e22e>title</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#a6e22e>width</span><span style=color:#f92672>=</span><span style=color:#a6e22e>100px</span> <span style=color:#960050;background-color:#1e0010>&gt;</span><span style=color:#75715e>}}</span> </span></span></code></pre></div><h2 id=les-icônes>Les icônes</h2><p>Pour générer plusieurs icônes j&rsquo;ai utilisé ce service <a href=https://www.favicon-generator.org/>Favicon-generetor</a>.
Il doit y en avoir d&rsquo;autres sur le web.
Ensuite, on les place dans ce dossier.</p><p><em>/themes/VOTRETHEME/static/img/favicons/</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>── logo-128x128.png
</span></span><span style=display:flex><span>├── logo-144x144.png
</span></span><span style=display:flex><span>├── logo-152x152.png
</span></span><span style=display:flex><span>├── logo-256x256.png
</span></span><span style=display:flex><span>├── logo-512x512.png
</span></span><span style=display:flex><span>├── logo-72x72.png
</span></span><span style=display:flex><span>└── logo-92x92.png</span></span></code></pre></div><h2 id=manifestjson>Manifest.json</h2><p>Maintenant, il faut remplir le <a href=https://pwa-workshop.js.org/fr/1-manifest/#proprietes-du-manifeste>manifest</a> avec vos données et vos icônes.</p><p>On le place dans le dossier <em>static</em> de votre théme.</p><p><em>/themes/VOTRETHEME/static/manifest.json</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;lang&#34;</span>: <span style=color:#e6db74>&#34;fr&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Schrek.fr&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;short_name&#34;</span>: <span style=color:#e6db74>&#34;schrek.fr&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Mon super site avec Hugo&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;icons&#34;</span>: [
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/img/favicons/logo-72x72.png&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sizes&#34;</span>: <span style=color:#e6db74>&#34;72x72&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;image/png&#34;</span>
</span></span><span style=display:flex><span>  }, {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/img/favicons/logo-92x92.png&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sizes&#34;</span>: <span style=color:#e6db74>&#34;92x92&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;image/png&#34;</span>
</span></span><span style=display:flex><span>  }, {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/img/favicons/logo-128x128.png&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sizes&#34;</span>: <span style=color:#e6db74>&#34;128x128&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;image/png&#34;</span>
</span></span><span style=display:flex><span>  }, {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/img/favicons/logo-144x144.png&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sizes&#34;</span>: <span style=color:#e6db74>&#34;144x144&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;image/png&#34;</span>
</span></span><span style=display:flex><span>  }, {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/img/favicons/logo-152x152.png&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sizes&#34;</span>: <span style=color:#e6db74>&#34;152x152&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;image/png&#34;</span>
</span></span><span style=display:flex><span>  }, {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/img/favicons/logo-256x256.png&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sizes&#34;</span>: <span style=color:#e6db74>&#34;256x256&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;image/png&#34;</span>
</span></span><span style=display:flex><span>    }, {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/img/favicons/logo-512x512.png&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sizes&#34;</span>: <span style=color:#e6db74>&#34;512x512&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;image/png&#34;</span>
</span></span><span style=display:flex><span>  }],
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;start_url&#34;</span>: <span style=color:#e6db74>&#34;/&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;display&#34;</span>: <span style=color:#e6db74>&#34;standalone&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;orientation&#34;</span> : <span style=color:#e6db74>&#34;portrait&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;background_color&#34;</span>: <span style=color:#e6db74>&#34;#000000&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;theme_color&#34;</span>: <span style=color:#e6db74>&#34;#000000&#34;</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=le-service-worker>Le service worker</h2><p>Une explication sur le site de <a href=https://developer.mozilla.org/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers>mozilla</a> de son rôle.</p><p>Je suis partie de ce depot <a href=https://github.com/wildhaber/offline-first-sw/tree/master>Git</a> que j&rsquo;ai personnalisé.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CACHE_VERSION</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>BASE_CACHE_FILES</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/style.css&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/uikit.min.js&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;uikit-icons.min.js&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/manifest.json&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/favicon.png&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/index.json&#39;</span>,
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>OFFLINE_CACHE_FILES</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/style.css&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/script.js&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/pages/hors_ligne/index.html&#39;</span>,
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>NOT_FOUND_CACHE_FILES</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/style.css&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/uikit.min.js&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;uikit-icons.min.js&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/404.html&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/pages/hors_ligne/index.html&#39;</span>,
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>OFFLINE_PAGE</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/pages/hors_ligne/index.html&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>NOT_FOUND_PAGE</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/404.html&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CACHE_VERSIONS</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>assets</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;assets-v&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>CACHE_VERSION</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;content-v&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>CACHE_VERSION</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>offline</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;offline-v&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>CACHE_VERSION</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>notFound</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;404-v&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>CACHE_VERSION</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define MAX_TTL&#39;s in SECONDS for specific file extensions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MAX_TTL</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3600</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>html</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3600</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>json</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>86400</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>js</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>86400</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>css</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>86400</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CACHE_BLACKLIST</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#75715e>//(str) =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//    return !str.startsWith(&#39;https://schrek.fr&#39;) ;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//},
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>SUPPORTED_METHODS</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;GET&#39;</span>,
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * isBlackListed
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {string} url
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @returns {boolean}
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isBlacklisted</span>(<span style=color:#a6e22e>url</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>CACHE_BLACKLIST</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>?</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>CACHE_BLACKLIST</span>.<span style=color:#a6e22e>filter</span>((<span style=color:#a6e22e>rule</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>rule</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;function&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>rule</span>(<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }).<span style=color:#a6e22e>length</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * getFileExtension
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {string} url
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @returns {string}
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getFileExtension</span>(<span style=color:#a6e22e>url</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>extension</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;.&#39;</span>).<span style=color:#a6e22e>reverse</span>()[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;?&#39;</span>)[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>extension</span>.<span style=color:#a6e22e>endsWith</span>(<span style=color:#e6db74>&#39;/&#39;</span>)) <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>extension</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * getTTL
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {string} url
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getTTL</span>(<span style=color:#a6e22e>url</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;string&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>extension</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getFileExtension</span>(<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>MAX_TTL</span>[<span style=color:#a6e22e>extension</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;number&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>MAX_TTL</span>[<span style=color:#a6e22e>extension</span>];
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * installServiceWorker
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @returns {Promise}
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>installServiceWorker</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Promise.<span style=color:#a6e22e>all</span>(
</span></span><span style=display:flex><span>        [
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>caches</span>.<span style=color:#a6e22e>open</span>(<span style=color:#a6e22e>CACHE_VERSIONS</span>.<span style=color:#a6e22e>assets</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>cache</span>) =&gt; {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>addAll</span>(<span style=color:#a6e22e>BASE_CACHE_FILES</span>);
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                ),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>caches</span>.<span style=color:#a6e22e>open</span>(<span style=color:#a6e22e>CACHE_VERSIONS</span>.<span style=color:#a6e22e>offline</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>cache</span>) =&gt; {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>addAll</span>(<span style=color:#a6e22e>OFFLINE_CACHE_FILES</span>);
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                ),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>caches</span>.<span style=color:#a6e22e>open</span>(<span style=color:#a6e22e>CACHE_VERSIONS</span>.<span style=color:#a6e22e>notFound</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>cache</span>) =&gt; {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>addAll</span>(<span style=color:#a6e22e>NOT_FOUND_CACHE_FILES</span>);
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>then</span>(() =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>self</span>.<span style=color:#a6e22e>skipWaiting</span>();
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * cleanupLegacyCache
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @returns {Promise}
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>cleanupLegacyCache</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>currentCaches</span> <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>CACHE_VERSIONS</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>map</span>(
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>key</span>) =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CACHE_VERSIONS</span>[<span style=color:#a6e22e>key</span>];
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise(
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>caches</span>.<span style=color:#a6e22e>keys</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>keys</span>) =&gt; {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>legacyKeys</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>keys</span>.<span style=color:#a6e22e>filter</span>(
</span></span><span style=display:flex><span>                            (<span style=color:#a6e22e>key</span>) =&gt; {
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>return</span> <span style=color:#f92672>!~</span><span style=color:#a6e22e>currentCaches</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#a6e22e>key</span>);
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>                        );
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>legacy</span>) =&gt; {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>legacy</span>.<span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>                            Promise.<span style=color:#a6e22e>all</span>(
</span></span><span style=display:flex><span>                                <span style=color:#a6e22e>legacy</span>.<span style=color:#a6e22e>map</span>(
</span></span><span style=display:flex><span>                                    (<span style=color:#a6e22e>legacyKey</span>) =&gt; {
</span></span><span style=display:flex><span>                                        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>caches</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#a6e22e>legacyKey</span>)
</span></span><span style=display:flex><span>                                    }
</span></span><span style=display:flex><span>                                )
</span></span><span style=display:flex><span>                            )
</span></span><span style=display:flex><span>                                .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                                    () =&gt; {
</span></span><span style=display:flex><span>                                        <span style=color:#a6e22e>resolve</span>()
</span></span><span style=display:flex><span>                                    }
</span></span><span style=display:flex><span>                                )
</span></span><span style=display:flex><span>                                .<span style=color:#66d9ef>catch</span>(
</span></span><span style=display:flex><span>                                    (<span style=color:#a6e22e>err</span>) =&gt; {
</span></span><span style=display:flex><span>                                        <span style=color:#a6e22e>reject</span>(<span style=color:#a6e22e>err</span>);
</span></span><span style=display:flex><span>                                    }
</span></span><span style=display:flex><span>                                );
</span></span><span style=display:flex><span>                        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                            <span style=color:#a6e22e>resolve</span>();
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                .<span style=color:#66d9ef>catch</span>(
</span></span><span style=display:flex><span>                    () =&gt; {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>reject</span>();
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>precacheUrl</span>(<span style=color:#a6e22e>url</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>isBlacklisted</span>(<span style=color:#a6e22e>url</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>caches</span>.<span style=color:#a6e22e>open</span>(<span style=color:#a6e22e>CACHE_VERSIONS</span>.<span style=color:#a6e22e>content</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>cache</span>) =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>url</span>)
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>response</span>) =&gt; {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>url</span>)
</span></span><span style=display:flex><span>                        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                            <span style=color:#75715e>// already in cache, nothing to do.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    })
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>response</span>) =&gt; {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>put</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>clone</span>());
</span></span><span style=display:flex><span>                        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    });
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>self</span>.<span style=color:#a6e22e>addEventListener</span>(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;install&#39;</span>, <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>waitUntil</span>(
</span></span><span style=display:flex><span>            Promise.<span style=color:#a6e22e>all</span>([
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>installServiceWorker</span>(),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>self</span>.<span style=color:#a6e22e>skipWaiting</span>(),
</span></span><span style=display:flex><span>            ])
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The activate handler takes care of cleaning up old caches.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>self</span>.<span style=color:#a6e22e>addEventListener</span>(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;activate&#39;</span>, <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>waitUntil</span>(
</span></span><span style=display:flex><span>            Promise.<span style=color:#a6e22e>all</span>(
</span></span><span style=display:flex><span>                [
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>cleanupLegacyCache</span>(),
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>self</span>.<span style=color:#a6e22e>clients</span>.<span style=color:#a6e22e>claim</span>(),
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>self</span>.<span style=color:#a6e22e>skipWaiting</span>(),
</span></span><span style=display:flex><span>                ]
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>                .<span style=color:#66d9ef>catch</span>(
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>err</span>) =&gt; {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>skipWaiting</span>();
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>self</span>.<span style=color:#a6e22e>addEventListener</span>(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;fetch&#39;</span>, <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>respondWith</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>caches</span>.<span style=color:#a6e22e>open</span>(<span style=color:#a6e22e>CACHE_VERSIONS</span>.<span style=color:#a6e22e>content</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>cache</span>) =&gt; {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>)
</span></span><span style=display:flex><span>                            .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                                (<span style=color:#a6e22e>response</span>) =&gt; {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>headers</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>entries</span>();
</span></span><span style=display:flex><span>                                        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>date</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pair</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>headers</span>) {
</span></span><span style=display:flex><span>                                            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>pair</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;date&#39;</span>) {
</span></span><span style=display:flex><span>                                                <span style=color:#a6e22e>date</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>pair</span>[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>                                            }
</span></span><span style=display:flex><span>                                        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>date</span>) {
</span></span><span style=display:flex><span>                                            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>age</span> <span style=color:#f92672>=</span> parseInt((<span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>getTime</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>date</span>.<span style=color:#a6e22e>getTime</span>()) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span>);
</span></span><span style=display:flex><span>                                            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>ttl</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getTTL</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ttl</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>age</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ttl</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise(
</span></span><span style=display:flex><span>                                                    (<span style=color:#a6e22e>resolve</span>) =&gt; {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                                        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>clone</span>())
</span></span><span style=display:flex><span>                                                            .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                                                                (<span style=color:#a6e22e>updatedResponse</span>) =&gt; {
</span></span><span style=display:flex><span>                                                                    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>updatedResponse</span>) {
</span></span><span style=display:flex><span>                                                                        <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>put</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>updatedResponse</span>.<span style=color:#a6e22e>clone</span>());
</span></span><span style=display:flex><span>                                                                        <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>updatedResponse</span>);
</span></span><span style=display:flex><span>                                                                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                                                                        <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>response</span>)
</span></span><span style=display:flex><span>                                                                    }
</span></span><span style=display:flex><span>                                                                }
</span></span><span style=display:flex><span>                                                            )
</span></span><span style=display:flex><span>                                                            .<span style=color:#66d9ef>catch</span>(
</span></span><span style=display:flex><span>                                                                () =&gt; {
</span></span><span style=display:flex><span>                                                                    <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>response</span>);
</span></span><span style=display:flex><span>                                                                }
</span></span><span style=display:flex><span>                                                            );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                                    }
</span></span><span style=display:flex><span>                                                )
</span></span><span style=display:flex><span>                                                    .<span style=color:#66d9ef>catch</span>(
</span></span><span style=display:flex><span>                                                        (<span style=color:#a6e22e>err</span>) =&gt; {
</span></span><span style=display:flex><span>                                                            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>;
</span></span><span style=display:flex><span>                                                        }
</span></span><span style=display:flex><span>                                                    );
</span></span><span style=display:flex><span>                                            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                                                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>;
</span></span><span style=display:flex><span>                                            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                                            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>;
</span></span><span style=display:flex><span>                                        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                                        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>                                    }
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                            )
</span></span><span style=display:flex><span>                            .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                                (<span style=color:#a6e22e>response</span>) =&gt; {
</span></span><span style=display:flex><span>                                    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>                                        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>;
</span></span><span style=display:flex><span>                                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                                        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>clone</span>())
</span></span><span style=display:flex><span>                                            .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                                                (<span style=color:#a6e22e>response</span>) =&gt; {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                                    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>400</span>) {
</span></span><span style=display:flex><span>                                                        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span><span style=color:#a6e22e>SUPPORTED_METHODS</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>method</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>isBlacklisted</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>url</span>)) {
</span></span><span style=display:flex><span>                                                            <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>put</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>clone</span>());
</span></span><span style=display:flex><span>                                                        }
</span></span><span style=display:flex><span>                                                        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>;
</span></span><span style=display:flex><span>                                                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                                                        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>caches</span>.<span style=color:#a6e22e>open</span>(<span style=color:#a6e22e>CACHE_VERSIONS</span>.<span style=color:#a6e22e>notFound</span>).<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>cache</span>) =&gt; {
</span></span><span style=display:flex><span>                                                            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>NOT_FOUND_PAGE</span>);
</span></span><span style=display:flex><span>                                                        })
</span></span><span style=display:flex><span>                                                    }
</span></span><span style=display:flex><span>                                                }
</span></span><span style=display:flex><span>                                            )
</span></span><span style=display:flex><span>                                            .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>response</span>) =&gt; {
</span></span><span style=display:flex><span>                                                <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>                                                    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>;
</span></span><span style=display:flex><span>                                                }
</span></span><span style=display:flex><span>                                            })
</span></span><span style=display:flex><span>                                            .<span style=color:#66d9ef>catch</span>(
</span></span><span style=display:flex><span>                                                () =&gt; {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                                    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>caches</span>.<span style=color:#a6e22e>open</span>(<span style=color:#a6e22e>CACHE_VERSIONS</span>.<span style=color:#a6e22e>offline</span>)
</span></span><span style=display:flex><span>                                                        .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>                                                            (<span style=color:#a6e22e>offlineCache</span>) =&gt; {
</span></span><span style=display:flex><span>                                                                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>offlineCache</span>.<span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>OFFLINE_PAGE</span>)
</span></span><span style=display:flex><span>                                                            }
</span></span><span style=display:flex><span>                                                        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                                }
</span></span><span style=display:flex><span>                                            );
</span></span><span style=display:flex><span>                                    }
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                            )
</span></span><span style=display:flex><span>                            .<span style=color:#66d9ef>catch</span>(
</span></span><span style=display:flex><span>                                (<span style=color:#a6e22e>error</span>) =&gt; {
</span></span><span style=display:flex><span>                                    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;  Error in fetch handler:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>                                    <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                            );
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>self</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;message&#39;</span>, (<span style=color:#a6e22e>event</span>) =&gt; {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;object&#39;</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>action</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;string&#39;</span>
</span></span><span style=display:flex><span>    ) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>action</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;cache&#39;</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>precacheUrl</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>default</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Unknown action: &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>action</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>});</span></span></code></pre></div><h2 id=partial>Partial</h2><p>Création du partial pour integrer PWA dans Hugo.</p><p><em>/themes/VOTRETHEME/layouts/partials/pwa.html</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;manifest&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/manifest.json&#34;</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mobile-web-app-capable&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yes&#34;</span> /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;apple-mobile-web-app-title&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;My PWA&#34;</span> /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;apple-mobile-web-app-status-bar-style&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;black-translucent&#34;</span> /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#e6db74>&#39;serviceWorker&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>navigator</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>navigator</span>.<span style=color:#a6e22e>serviceWorker</span>.<span style=color:#a6e22e>register</span>(<span style=color:#e6db74>&#39;/sw.js&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div><p>Et on ajoute a notre <em>head.html</em> pour être prit en compte.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>{{- partial &#34;pwa.html&#34; . -}}</span></span></code></pre></div><h2 id=mots-de-la-fin>Mots de la fin</h2><p>J&rsquo;ai testé sur differents téléphones android et IOS, des fois ca marche bien et d&rsquo;autre fois à moitié.</p><div class="attachments-files uk-card uk-card-small uk-width-1-3@m uk-padding"><h3 class=attachments-files-titre>Téléchargement <span uk-icon="icon: cloud-download;ratio:2"></span></h3><div class=attachments-files><li><a href=/posts/2023/09/Hugo-Pwa/files/1024.png>1024.png</a></li><li><a href=/posts/2023/09/Hugo-Pwa/files/pwa.webp>pwa.webp</a></li></div></div><h2 id=liens>Liens</h2><p><a href=https://fr.wikipedia.org/wiki/Progressive_web_app>https://fr.wikipedia.org/wiki/Progressive_web_app</a></p><p><a href=https://jamstatic.fr/2017/03/11/mode-offline-avec-hugo/>https://jamstatic.fr/2017/03/11/mode-offline-avec-hugo/</a></p><p><a href=https://www.pwabuilder.com/imageGenerator>https://www.pwabuilder.com/imageGenerator</a></p><p><a href=https://github.com/wildhaber/offline-first-sw>https://github.com/wildhaber/offline-first-sw</a></p><p><a href=https://discourse.gohugo.io/t/simple-implementation-of-progressive-web-apps-pwa-on-hugo-website/39952>https://discourse.gohugo.io/t/simple-implementation-of-progressive-web-apps-pwa-on-hugo-website/39952</a></p></p></article><ul class=uk-pagination><li><a class=uk-link-heading href=https://schrek.fr/posts/2023/09/la-griffe-du-chien/><span class=uk-margin-small-right uk-pagination-previous></span> La griffe du chien - Don Winslow</a></li><li class=uk-margin-auto-left><a class=uk-link-heading href=https://schrek.fr/posts/2023/09/latex-icones/>Les icones dans Latex<span class=uk-margin-small-left uk-pagination-next></span></a></li></ul><hr class=uk-divider-icon><div class="uk-grid-small uk-child-width-auto" uk-grid><div><p class=uk-text-light><span uk-icon=icon:hashtag></span>TAGS</p><ul class="uk-list uk-display-inline-block"><li><a class="uk-button uk-button-default" href=https://schrek.fr/tags/liens/>Liens</a></li><li><a class="uk-button uk-button-default" href=https://schrek.fr/tags/hugo/>Hugo</a></li><li><a class="uk-button uk-button-default" href=https://schrek.fr/tags/pwa/>Pwa</a></li></ul><br><a href=https://ko-fi.com/Q5Q7LH0AN target=_blank><img height=36 style=border:0;height:36px src='https://storage.ko-fi.com/cdn/kofi2.png?v=3' border=0 alt='Buy Me a Beer at ko-fi.com'></a></div></div></div></main><footer><div class="uk-container uk-container-small uk-background-muted uk-margin-small-top uk-padding-small">2024 - Construit avec <a class=uk-link-muted href=https://gohugo.io/>Hugo</a> et de <a class=uk-link-muted href=https://getuikit.com/>UiKit</a></div></footer><script src=/js/uikit.min.min.b795e52a95a6766546e08686e5d002243ef20e0fb3c22c860b7bd2adb02129b7.js integrity="sha256-t5XlKpWmdmVG4IaG5dACJD7yDg+zwiyGC3vSrbAhKbc=" crossorigin=anonymous></script><script defer src=/js/uikit-icons.min.min.992015e15d0a403b809bb04d0599e2873818150584953ed5864664037c6b4333.js integrity="sha256-mSAV4V0KQDuAm7BNBZnihzgYFQWElT7VhkZkA3xrQzM=" crossorigin=anonymous></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"]]}}</script></body></html>