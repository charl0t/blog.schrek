<!doctype html><html lang=fr><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Blog qui parle de lecture et de web"><meta name=keywords content="hugo,html,lecture,web,shortcode"><title>Schrek.fr</title>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="My PWA"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js")</script><meta property="og:url" content="https://schrek.fr/posts/2023/10/mqtt/"><meta property="og:site_name" content="Schrek.fr"><meta property="og:title" content="MQTT"><meta property="og:description" content="Créé par Andy Stanford-Clark et Arlen Nipper en 1999, MQTT est un protocole de messagerie qui permet aux objets connectés d’échanger les informations en toutes sécurité et avec une faible bande passante.
Les termes utilisés Broker: c’est le programme qui centralise les informations, il reçoit et envoie des messages comme la température d’un capteur. Le broker de référence sous Linux s’appelle Mosquitto. Publish: c’est l’action d’envoyer l’information du capteur vers le Broker( programme). Subscribe: c’est quand un programme s’abonne a un broker pour recuperer des informations. Topic: c’est les rubriques ou sont classés les données par exemple esp32/maison/chambre. QoS (Quality Of Service ) MQTT possede 3 niveau de qualité de service:"><meta property="og:locale" content="fr_fr"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-25T00:00:00+00:00"><meta property="article:modified_time" content="2023-10-25T00:00:00+00:00"><meta property="article:tag" content="MQTT"><meta property="article:tag" content="Domotique"><meta property="article:tag" content="Tasmota"><meta property="article:tag" content="Home-Assistant"><meta property="og:see_also" content="https://schrek.fr/posts/2023/10/tasmota/"><link href=/css/uikit.min.min.74065b0cc0cc771b6d0c8cdd1571f95022330dbe057cfe7f5c22ddf003313c6715e6047ab88bb5766ca27342b6d7b572f78f0fa2110438c5a0edeb269788d553.css rel=stylesheet integrity="sha512-dAZbDMDMdxttDIzdFXH5UCIzDb4FfP5/XCLd8AMxPGcV5gR6uIu1dmyic0K217Vy948PohEEOMWg7esml4jVUw==" crossorigin=anonymous><link href=/css/styles.min.afcd884f8dd136efa1b96e7cda014003cf94c49f183f0ef14bd022c6177e966c32c7161005a9388651cb103eec51f4106a0aa012b8812a467a1429f3d13cddd1.css rel=stylesheet integrity="sha512-r82IT43RNu+huW582gFAA8+UxJ8YPw7xS9Aixhd+lmwyxxYQBak4hlHLED7sUfQQagqgEriBKkZ6FCnz0Tzd0Q==" crossorigin=anonymous></head><body><header><nav class="uk-navbar-container uk-navbar-transparent" uk-navbar><div class=uk-navbar-center><a class="uk-navbar-item uk-logo" href=https://schrek.fr/><h1 classe=uk-heading-small>Schrek.fr</h1></a><ul class=uk-navbar-nav><li><a href=/><span uk-icon="icon:home; ratio: 2"></span></a><div class=uk-navbar-subtitle>Home</div></li><li><a href=/pages/apropos/><span uk-icon="icon:info; ratio: 2"></span></a><div class=uk-navbar-subtitle>A Propos</div></li><li><a href=/wiki/><span uk-icon="icon:database; ratio: 2"></span></a><div class=uk-navbar-subtitle>Wiki</div></li><li><a href=/notes/><span uk-icon="icon:pencil; ratio: 2"></span></a><div class=uk-navbar-subtitle>Notes</div></li><li><a href=/pages/tagscloud/><span uk-icon="icon:hashtag; ratio: 2"></span></a><div class=uk-navbar-subtitle>Tags</div></li><li><a href=/pages/search/><span uk-icon="icon:search; ratio: 2"></span></a><div class=uk-navbar-subtitle>Recherche</div></li><li><a href=/index.xml><span uk-icon="icon:rss; ratio: 2"></span></a><div class=uk-navbar-subtitle>RSS</div></li></ul></div></nav><hr class=uk-divider-icon></header><main><div class="uk-container uk-background-muted uk-box-shadow-large uk-padding"><ol class=uk-breadcrumb><li><a href=/>home</a></li><li><a href=https://schrek.fr/posts>posts</a></li><li><a href=https://schrek.fr/posts/2023>2023</a></li><li><a href=https://schrek.fr/posts/2023/10>10</a></li><li><a href=https://schrek.fr/posts/2023/10/mqtt>mqtt</a></li></ol><article class=uk-article><h1 class=uk-article-title>MQTT</h1><p class=uk-article-meta>2023-10-25
<span class="labelcat uk-label"><a href=/categories/iot>IoT</a></span><br><i>Temps de lecture: 1 minutes.</i></p><p>Cet article fait partie de la série: <a href=https://schrek.fr//series/domotique>Domotique</a></p><br><p class=uk-text-lead><div class="uk-section uk-align-right"><div class="uk-card-small uk-card-default uk-card-body" uk-scrollspy="cls: uk-animation-slide-right; repeat: false"><h3 class=uk-card-title>Table des matières</h3><p class="toc uk-text-small"><nav id=TableOfContents><ul><li><a href=#les-termes-utilisés>Les termes utilisés</a></li><li><a href=#qos-quality-of-service->QoS (Quality Of Service )</a></li><li><a href=#fonctionnement>Fonctionnement</a></li><li><a href=#configuration-avec-tasmota>Configuration avec Tasmota</a></li><li><a href=#configuration-home-assistant>Configuration Home-assistant</a></li><li><a href=#mqttexplorer>MQTTexplorer</a></li><li><a href=#résultat-dans-home-assistant>Résultat dans home-assistant</a></li><li><a href=#liens>Liens</a></li></ul></nav></p></div></div><p>Créé par Andy Stanford-Clark et Arlen Nipper en 1999, MQTT est un protocole de messagerie qui permet aux objets connectés d’échanger les informations en toutes sécurité et avec une faible bande passante.</p><h2 id=les-termes-utilisés>Les termes utilisés</h2><ul><li>Broker: c&rsquo;est le programme qui centralise les informations, il reçoit et envoie des messages comme la température d&rsquo;un capteur. Le broker de référence sous Linux s’appelle <a href=https://mosquitto.org/>Mosquitto</a>.</li><li>Publish: c&rsquo;est l&rsquo;action d&rsquo;envoyer l&rsquo;information du capteur vers le Broker( programme).</li><li>Subscribe: c&rsquo;est quand un programme s&rsquo;abonne a un broker pour recuperer des informations.</li><li>Topic: c&rsquo;est les rubriques ou sont classés les données par exemple <em>esp32/maison/chambre</em>.</li></ul><h2 id=qos-quality-of-service->QoS (Quality Of Service )</h2><p>MQTT possede 3 niveau de qualité de service:</p><p>Pour chaque topic, MQTT permet de gérer la QoS désirée, les messages seront délivrés :</p><ul><li>QoS 0 : Une fois au plus</li><li>QoS 1 : Une fois au moins</li><li>QoS 2 : Exactement une seule fois</li></ul><h2 id=fonctionnement>Fonctionnement</h2><figure class=imagearticle><img src=/posts/2023/10/mqtt/mqtt-architecture.webp width=400px></figure><p>Exemple d&rsquo;envoi<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>16:31:08.375 MQT: stat/tasmota_63753D/STATUS2 <span style=color:#f92672>=</span> <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;StatusFWR&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;Version&#34;</span>:<span style=color:#e6db74>&#34;13.1.0.2(tasmota)&#34;</span>,<span style=color:#e6db74>&#34;BuildDateTime&#34;</span>:<span style=color:#e6db74>&#34;2023-09-03T16:37:03&#34;</span>,<span style=color:#e6db74>&#34;Boot&#34;</span>:31,<span style=color:#e6db74>&#34;Core&#34;</span>:<span style=color:#e6db74>&#34;2_7_4_9&#34;</span>,<span style=color:#e6db74>&#34;SDK&#34;</span>:<span style=color:#e6db74>&#34;2.2.2-dev(38a443e)&#34;</span>,<span style=color:#e6db74>&#34;CpuFrequency&#34;</span>:80,<span style=color:#e6db74>&#34;Hardware&#34;</span>:<span style=color:#e6db74>&#34;ESP8266EX&#34;</span>,<span style=color:#e6db74>&#34;CR&#34;</span>:<span style=color:#e6db74>&#34;396/699&#34;</span><span style=color:#f92672>}}</span>
</span></span><span style=display:flex><span>16:31:08.427 MQT: stat/tasmota_63753D/STATUS10 <span style=color:#f92672>=</span> <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;StatusSNS&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;Time&#34;</span>:<span style=color:#e6db74>&#34;2023-09-18T16:31:08&#34;</span>,<span style=color:#e6db74>&#34;AM2301&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;Temperature&#34;</span>:27.4,<span style=color:#e6db74>&#34;Humidity&#34;</span>:68.0,<span style=color:#e6db74>&#34;DewPoint&#34;</span>:21.0<span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;TempUnit&#34;</span>:<span style=color:#e6db74>&#34;C&#34;</span><span style=color:#f92672>}}</span></span></span></code></pre></div></p><h2 id=configuration-avec-tasmota>Configuration avec Tasmota</h2><p>J&rsquo;ai repris le montage de l&rsquo;article précedent avec le AM2301 comme capteur.</p><p>Rien de compliqué, on active MQTT.<figure class=imagearticle><img src=/posts/2023/10/mqtt/tasmota1.webp width=400px></figure>Et on le configure.<figure class=imagearticle><img src=/posts/2023/10/mqtt/tasmota2.webp width=400px></figure></p><h2 id=configuration-home-assistant>Configuration Home-assistant</h2><ul><li>On va créer un utilisateur dans home assistant par exemple mosquitto avec un mot de passe compliqué</li><li>On ajoute le module <a href=https://www.home-assistant.io/integrations/mqtt/>Mosquitto</a>.</li></ul><p>Dans Parametres &ndash;> Modules complementaire &ndash;> Boutique des modules complementaires.</p><p>Le paramétrage est <a href=https://devotics.fr/installer-mqtt-sur-home-assistant/>facile</a>.</p><p>Ensuite, on va creer notre capteur(sensor) qui va recuperer les infos, à ajouter dans votre <em>configuration.yaml</em>.</p><p>(Voir la section MQTTexplorer pour le chemin )</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  - sensor:
</span></span><span style=display:flex><span>      name: <span style=color:#e6db74>&#34;tmp_solaire&#34;</span>
</span></span><span style=display:flex><span>      unique_id: <span style=color:#e6db74>&#34;tmp_solaire&#34;</span>
</span></span><span style=display:flex><span>      state_topic: <span style=color:#e6db74>&#34;tele/tasmota_63753D/SENSOR&#34;</span>
</span></span><span style=display:flex><span>      device_class: <span style=color:#e6db74>&#34;Temperature&#34;</span>
</span></span><span style=display:flex><span>      unit_of_measurement: <span style=color:#e6db74>&#34;C&#34;</span>
</span></span><span style=display:flex><span>      value_template: <span style=color:#e6db74>&#39;{{ value_json.AM2301.Temperature }}&#39;</span></span></span></code></pre></div><h2 id=mqttexplorer>MQTTexplorer</h2><p>Avec <a href=https://mqtt-explorer.com/>mqtt-explorer</a>, on peut verifier les données qui sont sur le broker.</p><p>Surtout le chemin pour completer <em>state_topic</em> et <em>value_template</em> dans Home-Assistant.</p><figure class=imagearticle><img src=/posts/2023/10/mqtt/mqttexplorer.webp width=400px></figure><h2 id=résultat-dans-home-assistant>Résultat dans home-assistant</h2><figure class=imagearticle><img src=/posts/2023/10/mqtt/home.webp width=400px></figure><h2 id=liens>Liens</h2><p><a href=https://fr.wikipedia.org/wiki/MQTT>https://fr.wikipedia.org/wiki/MQTT</a></p><p><a href=https://aws.amazon.com/fr/what-is/mqtt/>https://aws.amazon.com/fr/what-is/mqtt/</a></p><p><a href=https://fr.linkedin.com/pulse/mqtt-expliqu%C3%A9-en-fran%C3%A7ais-rapha%C3%ABl-delstanche>https://fr.linkedin.com/pulse/mqtt-expliqu%C3%A9-en-fran%C3%A7ais-rapha%C3%ABl-delstanche</a></p><p><a href=https://mosquitto.org/>https://mosquitto.org/</a></p><p><a href=https://devotics.fr/installer-mqtt-sur-home-assistant/>https://devotics.fr/installer-mqtt-sur-home-assistant/</a></p></p></article><ul class=uk-pagination><li><a class=uk-link-heading href=https://schrek.fr/posts/2023/12/rasp5/><span class=uk-margin-small-right uk-pagination-previous></span> Raspberrypi 5</a></li><li class=uk-margin-auto-left><a class=uk-link-heading href=https://schrek.fr/posts/2023/10/esp32-et-un-ecran-oled/>Un ecran oled pour Esp32<span class=uk-margin-small-left uk-pagination-next></span></a></li></ul><hr class=uk-divider-icon><div class="uk-grid-small uk-child-width-auto" uk-grid><div><p class=uk-text-light><span uk-icon=icon:hashtag></span>TAGS</p><ul class="uk-list uk-display-inline-block"><li><a class="uk-button uk-button-default" href=https://schrek.fr/tags/mqtt/>MQTT</a></li><li><a class="uk-button uk-button-default" href=https://schrek.fr/tags/domotique/>Domotique</a></li><li><a class="uk-button uk-button-default" href=https://schrek.fr/tags/tasmota/>Tasmota</a></li><li><a class="uk-button uk-button-default" href=https://schrek.fr/tags/home-assistant/>Home-Assistant</a></li></ul><br><a href=https://ko-fi.com/Q5Q7LH0AN target=_blank><img height=36 style=border:0;height:36px src='https://storage.ko-fi.com/cdn/kofi2.png?v=3' border=0 alt='Buy Me a Beer at ko-fi.com'></a></div></div></div></main><footer><div class="uk-container uk-container-small uk-background-muted uk-margin-small-top uk-padding-small">2024 - Construit avec <a class=uk-link-muted href=https://gohugo.io/>Hugo</a> et de <a class=uk-link-muted href=https://getuikit.com/>UiKit</a></div></footer><script src=/js/uikit.min.min.b795e52a95a6766546e08686e5d002243ef20e0fb3c22c860b7bd2adb02129b7.js integrity="sha256-t5XlKpWmdmVG4IaG5dACJD7yDg+zwiyGC3vSrbAhKbc=" crossorigin=anonymous></script><script defer src=/js/uikit-icons.min.min.992015e15d0a403b809bb04d0599e2873818150584953ed5864664037c6b4333.js integrity="sha256-mSAV4V0KQDuAm7BNBZnihzgYFQWElT7VhkZkA3xrQzM=" crossorigin=anonymous></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"]]}}</script></body></html>